function Task(e,t,i,a){e=e.replace(/ /g,""),t=t.replace(/ /g,""),this.source={},this.dest={},this.source.lat=e.split(",")[0],this.source["long"]=e.split(",")[1],this.dest.lat=t.split(",")[0],this.dest["long"]=t.split(",")[1],this.time=new Date,this.time.setHours(i.substring(0,2),i.slice(-2)),this.email=a.replace(/ /g,""),this.maxTravelTime=0}function checkInputs(e,t,i,a){return e=e.replace(/ /g,""),t=t.replace(/ /g,""),checkFloat(e.split(",")[0])&&checkFloat(e.split(",")[1])&&checkFloat(t.split(",")[0])&&checkFloat(t.split(",")[0])?!!checkEmail(a):!1}function checkFloat(e){return!isNaN(e)&&-1!=e.toString().indexOf(".")}function checkEmail(e){var t=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return!!t.test(e)}function getTravelTime(e){addLog("Requested Google Maps API for ["+e.email+"]");var t={source:e.source,dest:e.dest};postToServer("maps/estimateTime",t,function(t){if("error"==t)return addLog("ERROR in Maps API for ["+e.email+"]"),void setTimeout(function(){getTravelTime(e)},5e3);if(200!=t.code)return addLog("ERROR "+t.code+" from Maps API for ["+e.email+"]"),void setTimeout(function(){getTravelTime(e)},5e3);if(null==t.time)return addLog("NULL from Maps API for ["+e.email+"]"),void setTimeout(function(){getTravelTime(e)},5e3);(t.time+maxGoogleDeviation<e.maxTravelTime||0==e.maxTravelTime)&&(e.maxTravelTime=t.time+maxGoogleDeviation);var i=new Date,a=timeDiffInSeconds(e.time,i);if(a<=e.maxTravelTime+maxUberETA)addLog("Requested Uber API for ["+e.email+"]"),getUberTime(e,function(i){"error"==i||null==i?setTimeout(function(){getTravelTime(e)},5e3):a<=t.time+i+safeInterval?(addLog("Sending email to ["+e.email+"]"),sendEmail(e)):setTimeout(function(){getTravelTime(e)},6e4)}.bind(this));else{var n=a-e.maxTravelTime-maxUberETA;setTimeout(function(){getTravelTime(e)},1e3*n)}})}function getUberTime(e,t){var i={latitude:e.source.lat,longitude:e.source["long"]};postToServer("uber/estimateTime",i,function(i){return"error"==i?(addLog("ERROR in Uber API for ["+e.email+"]. Retrying in 5 seconds..."),void setTimeout(function(){getUberTime(e,t)},5e3)):200!=i.code?(addLog("ERROR "+i.code+" from Uber API for ["+e.email+"]. Retrying in 5 seconds..."),void setTimeout(function(){getUberTime(e,t)},5e3)):null==i.time?(addLog("NULL from Uber API for ["+e.email+"]. Retrying in 5 seconds..."),void setTimeout(function(){getUberTime(e,t)},5e3)):t(i.time)})}function sendEmail(e){var t={email:e.email};postToServer("email",t,function(t){return"error"==t?void addLog("ERROR in sending email to "+e.email):void 0})}function postToServer(e,t,i){$.ajax({url:domainUrl+e,type:"POST",contentType:"application/json",data:JSON.stringify(t),cache:!1,success:function(e){return i(e)},error:function(e,t,a){return i("error")}})}function timeDiffInSeconds(e,t){var i=e.getTime()-t.getTime();return Math.round(i/1e3)}function addLog(e){logs.unshift("["+amPm(new Date)+"] - "+e),$(APPCAB).trigger("log")}function amPm(e){var t=e.getHours()>=12?"PM":"AM",i=e.getHours()%12||12;i=("0"+i).slice(-2);var a=("0"+e.getMinutes()).slice(-2);return i+":"+a+" "+t}var domainUrl="http://localhost:3000/",maxGoogleDeviation=3600,maxUberETA=900,safeInterval=60,APPCAB={},logs=[],tasks=[];logs.unshift("["+amPm(new Date)+"] - Welcome :)");var FormModel=React.createClass({displayName:"FormModel",getInitialState:function(){return{source:"",dest:"",time:"",email:"",enabled:!0}},handleSourceChange:function(e){this.setState({source:e.target.value})},handleDestChange:function(e){this.setState({dest:e.target.value})},handleTimeChange:function(e){this.setState({time:e.target.value})},handleEmailChange:function(e){this.setState({email:e.target.value})},handleRemindMe:function(e){if(this.state.enabled){if(this.setState({enabled:!1}),!(this.state.source&&this.state.dest&&this.state.time&&this.state.email))return $("#error").show(),setTimeout(function(){$("#error").hide()},2e3),void this.setState({enabled:!0});if(!checkInputs(this.state.source,this.state.dest,this.state.time,this.state.email))return $("#error").show(),setTimeout(function(){$("#error").hide()},2e3),void this.setState({enabled:!0});var t=new Task(this.state.source,this.state.dest,this.state.time,this.state.email);addLog("Task added for "+this.state.email),getTravelTime(t),$("#success").show(),setTimeout(function(){$("#success").hide()},2e3),this.setState({source:"",dest:"",time:"",email:"",enabled:!0})}},render:function(){return React.createElement("div",null,React.createElement("h4",{className:"mybox-heading"},"It's time to book an Uber"),React.createElement("input",{type:"text",className:"form-control",id:"source",placeholder:"Latitude, Longitude (Source)",value:this.state.source,onChange:this.handleSourceChange}),React.createElement("input",{type:"text",className:"form-control",id:"dest",placeholder:"Latitude, Longitude (Destination)",value:this.state.dest,onChange:this.handleDestChange}),React.createElement("input",{type:"time",className:"form-control",id:"time",placeholder:"Time",value:this.state.time,onChange:this.handleTimeChange}),React.createElement("input",{type:"text",className:"form-control",id:"email",placeholder:"Email",value:this.state.email,onChange:this.handleEmailChange}),React.createElement("button",{className:"btn btn-md btn-primary btn-block",onClick:this.handleRemindMe},"REMIND ME"),React.createElement("div",{style:{marginTop:"10px"},className:"alert alert-success success",id:"success",hidden:!0},"Task added successfully."),React.createElement("div",{style:{marginTop:"10px"},className:"alert alert-warning error",id:"error",hidden:!0},"Please enter valid inputs."))}}),LogModel=React.createClass({displayName:"LogModel",componentDidMount:function(){$(APPCAB).on("log",function(e){this.forceUpdate()}.bind(this))},componentWillUnmount:function(){$(APPCAB).off("log")},render:function(){var e=logs.map(function(e,t){return React.createElement("div",{key:t},e)}.bind(this));return React.createElement("div",null,e)}});ReactDOM.render(React.createElement(FormModel,null),document.getElementById("form-model")),ReactDOM.render(React.createElement(LogModel,null),document.getElementById("log-model"));